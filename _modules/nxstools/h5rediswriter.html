<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nxstools.h5rediswriter &#8212; NXSTools 4.18.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          NXSTools</a>
        <span class="navbar-text navbar-version pull-left"><b>4.18</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../nxscollect.html">nxcollect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#synopsis-for-nxscollect-append">Synopsis for nxscollect append</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#examples-of-nxscollect-append">Examples of nxscollect append</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#synopsis-for-nxscollect-link">Synopsis for nxscollect link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#examples-of-nxscollect-link">Examples of nxscollect link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#synopsis-for-nxscollect-vds">Synopsis for nxscollect vds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscollect.html#examples-of-nxscollect-vds">Examples of nxscollect vds</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxsconfig.html">nxsconfig</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxsconfig.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsconfig.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsconfig.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxscreate.html">nxscreate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-clientds">nxscreate clientds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-tangods">nxscreate tangods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-deviceds">nxscreate deviceds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-onlineds">nxscreate onlineds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-poolds">nxscreate poolds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-onlinecp">nxscreate onlinecp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-stdcomp">nxscreate stdcomp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-comp">nxscreate comp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-secopcp">nxscreate secopcp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxscreate.html#nxscreate-compare">nxscreate compare</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxsdata.html">nxsdata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxsdata.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsdata.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsdata.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxsfileinfo.html">nxsfileinfo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-general">nxsfileinfo general</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-field">nxsfileinfo field</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-metadata">nxsfileinfo metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-origdatablock">nxsfileinfo origdatablock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-sample">nxsfileinfo sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-instrument">nxsfileinfo instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-attachment">nxsfileinfo attachment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsfileinfo.html#nxsfileinfo-groupmetadata">nxsfileinfo groupmetadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxsetup.html">nxsetup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-set">nxsetup set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-restart">nxsetup restart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-start">nxsetup start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-stop">nxsetup stop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-wait">nxsetup wait</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-move-prop">nxsetup move-prop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-change-prop">nxsetup change-prop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxsetup.html#nxsetup-add-recorder-path">nxsetup add-recorder-path</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nxstools.html">nxstools package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.filenamegenerator">nxstools.filenamegenerator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.filewriter">nxstools.filewriter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.h5cppwriter">nxstools.h5cppwriter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.h5pywriter">nxstools.h5pywriter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.h5rediswriter">nxstools.h5rediswriter module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsargparser">nxstools.nxsargparser module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxscollect">nxstools.nxscollect module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsconfig">nxstools.nxsconfig module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxscreate">nxstools.nxscreate module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxscreator">nxstools.nxscreator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsdata">nxstools.nxsdata module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsdevicetools">nxstools.nxsdevicetools module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsetup">nxstools.nxsetup module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsfileinfo">nxstools.nxsfileinfo module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsfileparser">nxstools.nxsfileparser module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsparser">nxstools.nxsparser module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.nxsxml">nxstools.nxsxml module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.release">nxstools.release module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools.redisutils">nxstools.redisutils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nxstools.html#module-nxstools">Module contents</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for nxstools.h5rediswriter</h1><div class="highlight"><pre>
<span></span><span class="c1">#   This file is part of nexdatas - Tango Server for NeXus data writer</span>
<span class="c1">#</span>
<span class="c1">#    Copyright (C) 2012-2017 DESY, Jan Kotanski &lt;jkotan@mail.desy.de&gt;</span>
<span class="c1">#</span>
<span class="c1">#    nexdatas is free software: you can redistribute it and/or modify</span>
<span class="c1">#    it under the terms of the GNU General Public License as published by</span>
<span class="c1">#    the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#    (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#    nexdatas is distributed in the hope that it will be useful,</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#    GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#    You should have received a copy of the GNU General Public License</span>
<span class="c1">#    along with nexdatas.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot; Provides redis h5cpp file writer &quot;&quot;&quot;</span>

<span class="c1"># import math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># from pninexus import h5cpp</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">filewriter</span>
<span class="kn">from</span> <span class="nn">.redisutils</span> <span class="kn">import</span> <span class="n">REDIS</span><span class="p">,</span> <span class="n">getDataStore</span>
<span class="kn">from</span> <span class="nn">.nxsfileparser</span> <span class="kn">import</span> <span class="p">(</span><span class="n">getdsname</span><span class="p">,</span> <span class="n">getdssource</span><span class="p">,</span>
                            <span class="c1"># getdstype</span>
                            <span class="p">)</span>


<span class="n">H5CPP</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">h5cppwriter</span> <span class="k">as</span> <span class="n">h5writer</span>
    <span class="n">H5File</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppFile</span>
    <span class="n">H5Group</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppGroup</span>
    <span class="n">H5Field</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppField</span>
    <span class="n">H5Link</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppLink</span>
    <span class="n">H5VirtualFieldLayout</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppVirtualFieldLayout</span>
    <span class="n">H5TargetFieldView</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppTargetFieldView</span>
    <span class="n">H5DataFilter</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppDataFilter</span>
    <span class="n">H5Deflate</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppDeflate</span>
    <span class="n">H5AttributeManager</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppAttributeManager</span>
    <span class="n">H5Attribute</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5CppAttribute</span>
    <span class="n">H5CPP</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">h5pywriter</span> <span class="k">as</span> <span class="n">h5writer</span>
    <span class="n">H5File</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYFile</span>
    <span class="n">H5Group</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYGroup</span>
    <span class="n">H5Field</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYField</span>
    <span class="n">H5Link</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYLink</span>
    <span class="n">H5VirtualFieldLayout</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYVirtualFieldLayout</span>
    <span class="n">H5TargetFieldView</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYTargetFieldView</span>
    <span class="n">H5DataFilter</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYDataFilter</span>
    <span class="n">H5Deflate</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYDeflate</span>
    <span class="n">H5AttributeManager</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYAttributeManager</span>
    <span class="n">H5Attribute</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">H5PYAttribute</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">blissdata.redis_engine.encoding.numeric</span> <span class="kn">import</span> <span class="n">NumericStreamEncoder</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">NumericStreamEncoder</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">blissdata.redis_engine.encoding.json</span> <span class="kn">import</span> <span class="n">JsonStreamEncoder</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">JsonStreamEncoder</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">blissdata.schemas.scan_info</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">ScanInfoDict</span><span class="p">,</span>
        <span class="n">DeviceDict</span><span class="p">,</span> <span class="n">ChainDict</span><span class="p">,</span> <span class="n">ChannelDict</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">ScanInfoDict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">DeviceDict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ChainDict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ChannelDict</span> <span class="o">=</span> <span class="kc">None</span>


<span class="n">attrdesc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nexus_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;depends_on&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;depends_on&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;trans_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;transformation_type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;trans_vector&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;trans_offset&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="c1"># &quot;source_name&quot;: [&quot;nexdatas_source&quot;, getdsname],</span>
    <span class="c1"># &quot;source_type&quot;: [&quot;nexdatas_source&quot;, getdstype],</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;nexdatas_source&quot;</span><span class="p">,</span> <span class="n">getdssource</span><span class="p">],</span>
    <span class="c1"># &quot;strategy&quot;: [&quot;nexdatas_strategy&quot;, str],</span>
<span class="p">}</span>


<div class="viewcode-block" id="splitstr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.splitstr">[docs]</a><span class="k">def</span> <span class="nf">splitstr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; split string separated by space</span>

<span class="sd">    :param text: text to split</span>
<span class="sd">    :type text: :obj:`str`</span>
<span class="sd">    :param text: split text</span>
<span class="sd">    :type text: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span></div>


<span class="n">progattrdesc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;npoints&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;npoints&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="s2">&quot;count_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;count_time&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="s2">&quot;measurement_group_channels&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;measurement_group_channels&quot;</span><span class="p">,</span> <span class="n">splitstr</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;scan_command&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
    <span class="s2">&quot;beamtime_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beamtime_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
<span class="p">}</span>


<div class="viewcode-block" id="nptype"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.nptype">[docs]</a><span class="k">def</span> <span class="nf">nptype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; converts to numpy types</span>

<span class="sd">    :param dtype: h5 writer type type</span>
<span class="sd">    :type dtype: :obj:`str`</span>
<span class="sd">    :returns: nupy type</span>
<span class="sd">    :rtype: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">nptype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span></div>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">str</span>


<span class="k">def</span> <span class="nf">_tostr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; converts text  to str type</span>

<span class="sd">    :param text: text</span>
<span class="sd">    :type text: :obj:`bytes` or :obj:`unicode`</span>
<span class="sd">    :returns: text in str type</span>
<span class="sd">    :rtype: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>


<div class="viewcode-block" id="unlimited_selection"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.unlimited_selection">[docs]</a><span class="k">def</span> <span class="nf">unlimited_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; checks if hyperslab is unlimited</span>

<span class="sd">    :param sel: hyperslab selection</span>
<span class="sd">    :type sel: :class:`filewriter.FTHyperslab`</span>
<span class="sd">    :param shape: give shape</span>
<span class="sd">    :type shape: :obj:`list`</span>
<span class="sd">    :returns: if hyperslab is unlimited list</span>
<span class="sd">    :rtype: :obj:`list` &lt;:obj:`bool`&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">unlimited_selection</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_slice2selection</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; converts slice(s) to selection</span>

<span class="sd">    :param t: slice tuple</span>
<span class="sd">    :type t: :obj:`tuple`</span>
<span class="sd">    :return shape: field shape</span>
<span class="sd">    :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">    :returns: hyperslab selection</span>
<span class="sd">    :rtype: :class:`h5cpp.dataspace.Hyperslab`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">_slice2selection</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>


<div class="viewcode-block" id="unlimited"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.unlimited">[docs]</a><span class="k">def</span> <span class="nf">unlimited</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; return dataspace UNLIMITED variable for the current writer module</span>

<span class="sd">    :param parent: parent object</span>
<span class="sd">    :type parent: :class:`FTObject`</span>
<span class="sd">    :returns:  dataspace UNLIMITED variable</span>
<span class="sd">    :rtype: :class:`h5cpp.dataspace.UNLIMITED`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">unlimited</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>


<div class="viewcode-block" id="open_file"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.open_file">[docs]</a><span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">redisurl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="o">**</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; open the new file</span>

<span class="sd">    :param filename: file name</span>
<span class="sd">    :type filename: :obj:`str`</span>
<span class="sd">    :param readonly: readonly flag</span>
<span class="sd">    :type readonly: :obj:`bool`</span>
<span class="sd">    :param redisurl: redis URL</span>
<span class="sd">    :type redisurl: :obj:`str`</span>
<span class="sd">    :param session: redis session</span>
<span class="sd">    :type session: :obj:`str`</span>
<span class="sd">    :param libver: library version: &#39;lastest&#39; or &#39;earliest&#39;</span>
<span class="sd">    :type libver: :obj:`str`</span>
<span class="sd">    :returns: file object</span>
<span class="sd">    :rtype: :class:`H5RedisFile`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisFile</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">readonly</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">),</span>
                       <span class="n">redisurl</span><span class="o">=</span><span class="n">redisurl</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_image_file_supported"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.is_image_file_supported">[docs]</a><span class="k">def</span> <span class="nf">is_image_file_supported</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; provides if loading of image files are supported</span>

<span class="sd">    :retruns: if loading of image files are supported</span>
<span class="sd">    :rtype: :obj:`bool`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">is_image_file_supported</span><span class="p">()</span></div>


<div class="viewcode-block" id="is_vds_supported"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.is_vds_supported">[docs]</a><span class="k">def</span> <span class="nf">is_vds_supported</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; provides if vds are supported</span>

<span class="sd">    :retruns: if vds are supported</span>
<span class="sd">    :rtype: :obj:`bool`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">is_vds_supported</span><span class="p">()</span></div>


<div class="viewcode-block" id="is_unlimited_vds_supported"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.is_unlimited_vds_supported">[docs]</a><span class="k">def</span> <span class="nf">is_unlimited_vds_supported</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; provides if unlimited vds are supported</span>

<span class="sd">    :retruns: if unlimited vds are supported</span>
<span class="sd">    :rtype: :obj:`bool`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">is_unlimited_vds_supported</span><span class="p">()</span></div>


<div class="viewcode-block" id="load_file"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.load_file">[docs]</a><span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="n">membuffer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; load a file from memory byte buffer</span>

<span class="sd">    :param membuffer: memory buffer</span>
<span class="sd">    :type membuffer: :obj:`bytes` or :obj:`io.BytesIO`</span>
<span class="sd">    :param filename: file name</span>
<span class="sd">    :type filename: :obj:`str`</span>
<span class="sd">    :param readonly: readonly flag</span>
<span class="sd">    :type readonly: :obj:`bool`</span>
<span class="sd">    :param pars: parameters</span>
<span class="sd">    :type pars: :obj:`dict` &lt; :obj:`str`, :obj:`str`&gt;</span>
<span class="sd">    :returns: file object</span>
<span class="sd">    :rtype: :class:`H5RedisFile`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisFile</span><span class="p">(</span>
        <span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">membuffer</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">readonly</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">))</span></div>


<div class="viewcode-block" id="create_file"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.create_file">[docs]</a><span class="k">def</span> <span class="nf">create_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">redisurl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create a new file</span>

<span class="sd">    :param filename: file name</span>
<span class="sd">    :type filename: :obj:`str`</span>
<span class="sd">    :param overwrite: overwrite flag</span>
<span class="sd">    :type overwrite: :obj:`bool`</span>
<span class="sd">    :param libver: library version: &#39;lastest&#39; or &#39;earliest&#39;</span>
<span class="sd">    :type libver: :obj:`str`</span>
<span class="sd">    :param redisurl: redis URL</span>
<span class="sd">    :type redisurl: :obj:`str`</span>
<span class="sd">    :param session: redis session</span>
<span class="sd">    :type session: :obj:`str`</span>
<span class="sd">    :returns: file object</span>
<span class="sd">    :rtype: :class:`H5RedisFile`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisFile</span><span class="p">(</span>
        <span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">),</span>
        <span class="n">redisurl</span><span class="o">=</span><span class="n">redisurl</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="link"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.link">[docs]</a><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create link</span>

<span class="sd">    :param target: nexus path name</span>
<span class="sd">    :type target: :obj:`str`</span>
<span class="sd">    :param parent: parent object</span>
<span class="sd">    :type parent: :class:`FTObject`</span>
<span class="sd">    :param name: link name</span>
<span class="sd">    :type name: :obj:`str`</span>
<span class="sd">    :returns: link object</span>
<span class="sd">    :rtype: :class:`H5RedisLink`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisLink</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_links"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.get_links">[docs]</a><span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; get links</span>

<span class="sd">    :param parent: parent object</span>
<span class="sd">    :type parent: :class:`FTObject`</span>
<span class="sd">    :returns: list of link objects</span>
<span class="sd">    :returns: link object</span>
<span class="sd">    :rtype: :obj: `list` &lt;:class:`H5RedisLink`&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">h5writer</span><span class="o">.</span><span class="n">get_links</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">H5RedisLink</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">lk</span><span class="p">)</span> <span class="k">for</span> <span class="n">lk</span> <span class="ow">in</span> <span class="n">links</span><span class="p">]</span></div>


<div class="viewcode-block" id="data_filter"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.data_filter">[docs]</a><span class="k">def</span> <span class="nf">data_filter</span><span class="p">(</span><span class="n">filterid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">availability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create data filter</span>

<span class="sd">    :param filterid: hdf5 filter id</span>
<span class="sd">    :type filterid: :obj:`int`</span>
<span class="sd">    :param name: filter name</span>
<span class="sd">    :type name: :obj:`str`</span>
<span class="sd">    :param options: filter cd values</span>
<span class="sd">    :type options: :obj:`tuple` &lt;:obj:`int`&gt;</span>
<span class="sd">    :param availability: filter availability i.e. &#39;optional&#39; or &#39;mandatory&#39;</span>
<span class="sd">    :type availability: :obj:`str`</span>
<span class="sd">    :param shuffle: filter shuffle</span>
<span class="sd">    :type shuffle: :obj:`bool`</span>
<span class="sd">    :param rate: filter shuffle</span>
<span class="sd">    :type rate: :obj:`bool`</span>
<span class="sd">    :returns: data filter object</span>
<span class="sd">    :rtype: :class:`H5RedisDataFilter`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisDataFilter</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">data_filter</span><span class="p">(</span>
        <span class="n">filterid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">availability</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">rate</span><span class="p">))</span></div>


<div class="viewcode-block" id="deflate_filter"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.deflate_filter">[docs]</a><span class="k">def</span> <span class="nf">deflate_filter</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">availability</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create data filter</span>

<span class="sd">    :param rate: filter shuffle</span>
<span class="sd">    :type rate: :obj:`bool`</span>
<span class="sd">    :param shuffle: filter shuffle</span>
<span class="sd">    :type shuffle: :obj:`bool`</span>
<span class="sd">    :returns: deflate filter object</span>
<span class="sd">    :rtype: :class:`H5RedisDataFilter`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisDataFilter</span><span class="p">(</span>
        <span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">deflate_filter</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">availability</span><span class="p">))</span></div>


<div class="viewcode-block" id="target_field_view"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.target_field_view">[docs]</a><span class="k">def</span> <span class="nf">target_field_view</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fieldpath</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span>
                      <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create target field view for VDS</span>

<span class="sd">    :param filename: file name</span>
<span class="sd">    :type filename: :obj:`str`</span>
<span class="sd">    :param fieldpath: nexus field path</span>
<span class="sd">    :type fieldpath: :obj:`str`</span>
<span class="sd">    :param shape: shape</span>
<span class="sd">    :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">    :param dtype: attribute type</span>
<span class="sd">    :type dtype: :obj:`str`</span>
<span class="sd">    :param maxshape: shape</span>
<span class="sd">    :type maxshape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">    :returns: target field view object</span>
<span class="sd">    :rtype: :class:`H5RedisTargetFieldView`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisTargetFieldView</span><span class="p">(</span>
        <span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">target_field_view</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">fieldpath</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">maxshape</span><span class="p">))</span></div>


<div class="viewcode-block" id="virtual_field_layout"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.virtual_field_layout">[docs]</a><span class="k">def</span> <span class="nf">virtual_field_layout</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; creates a virtual field layout for a VDS file</span>

<span class="sd">    :param shape: shape</span>
<span class="sd">    :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">    :param dtype: attribute type</span>
<span class="sd">    :type dtype: :obj:`str`</span>
<span class="sd">    :param maxshape: shape</span>
<span class="sd">    :type maxshape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">    :returns: virtual layout</span>
<span class="sd">    :rtype: :class:`H5RedisVirtualFieldLayout`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">H5RedisVirtualFieldLayout</span><span class="p">(</span>
        <span class="n">h5imp</span><span class="o">=</span><span class="n">h5writer</span><span class="o">.</span><span class="n">virtual_field_layout</span><span class="p">(</span>
            <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">maxshape</span><span class="p">))</span></div>


<div class="viewcode-block" id="H5RedisFile"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile">[docs]</a><span class="k">class</span> <span class="nc">H5RedisFile</span><span class="p">(</span><span class="n">H5File</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">redisurl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param filename:  file name</span>
<span class="sd">        :type filename: :obj:`str`</span>
<span class="sd">        :param h5imp: h5 implementation file</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTFile`</span>
<span class="sd">        :param redisurl: redis url string</span>
<span class="sd">        :type redisurl: :obj:`str`</span>
<span class="sd">        :param session: redis session</span>
<span class="sd">        :type session: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5File</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5File</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="c1">#: (:obj:`str`) redis url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__redisurl</span> <span class="o">=</span> <span class="n">redisurl</span> <span class="ow">or</span> <span class="s2">&quot;redis://localhost:6380&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__session</span> <span class="o">=</span> <span class="n">session</span> <span class="ow">or</span> <span class="s2">&quot;test_session&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datastore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scaninfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__devices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mgchannels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datastore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__entryname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__insname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">REDIS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__redisurl</span><span class="p">:</span>
            <span class="c1"># print(&quot;FILENAME&quot;, self.name)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__datastore</span> <span class="o">=</span> <span class="n">getDataStore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__redisurl</span><span class="p">)</span>

<div class="viewcode-block" id="H5RedisFile.root"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.root">[docs]</a>    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; root object</span>

<span class="sd">        :returns: parent object</span>
<span class="sd">        :rtype: :class:`H5RedisGroup`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisGroup</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">H5File</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                            <span class="n">nxclass</span><span class="o">=</span><span class="s2">&quot;NXroot&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisFile.append_stream"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.append_stream">[docs]</a>    <span class="k">def</span> <span class="nf">append_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param name: stream name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param scan: stream object</span>
<span class="sd">        :type scan: :class:`Stream`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span></div>

<div class="viewcode-block" id="H5RedisFile.set_scan"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_scan">[docs]</a>    <span class="k">def</span> <span class="nf">set_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param scan: scan object</span>
<span class="sd">        :type scan: :class:`Scan`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span> <span class="o">=</span> <span class="n">scan</span></div>

<div class="viewcode-block" id="H5RedisFile.set_entryname"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_entryname">[docs]</a>    <span class="k">def</span> <span class="nf">set_entryname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set entry name</span>

<span class="sd">        :param entryname: entry name</span>
<span class="sd">        :type entryname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__entryname</span> <span class="o">=</span> <span class="n">entryname</span></div>

<div class="viewcode-block" id="H5RedisFile.set_insname"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_insname">[docs]</a>    <span class="k">def</span> <span class="nf">set_insname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">insname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set instrument name</span>

<span class="sd">        :param insname: instrument name</span>
<span class="sd">        :type insname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__insname</span> <span class="o">=</span> <span class="n">insname</span></div>

<div class="viewcode-block" id="H5RedisFile.append_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.append_devices">[docs]</a>    <span class="k">def</span> <span class="nf">append_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append device info parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__devices</span>
            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisFile.set_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_devices">[docs]</a>    <span class="k">def</span> <span class="nf">set_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set device info parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__devices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__devices</span>

            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="H5RedisFile.get_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.get_devices">[docs]</a>    <span class="k">def</span> <span class="nf">get_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get devices info parameters</span>

<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: device parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__devices</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dinfo</span><span class="p">)</span>

            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">dinfo</span></div>

<div class="viewcode-block" id="H5RedisFile.set_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_channels">[docs]</a>    <span class="k">def</span> <span class="nf">set_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set channel info parameters</span>

<span class="sd">        :param value: channel parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: channel parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channels</span>

            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="H5RedisFile.get_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.get_channels">[docs]</a>    <span class="k">def</span> <span class="nf">get_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get channel info parameters</span>

<span class="sd">        :param keys: channel parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: channel parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="n">dinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channels</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dinfo</span><span class="p">)</span>

            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">dinfo</span></div>

<div class="viewcode-block" id="H5RedisFile.reset_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.reset_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">reset_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; reset scan info</span>

<span class="sd">        :param entryname: NXentry group name</span>
<span class="sd">        :type entryname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_entryname</span><span class="p">(</span><span class="n">entryname</span><span class="p">)</span>

        <span class="n">localfname</span> <span class="o">=</span> <span class="n">H5RedisLink</span><span class="o">.</span><span class="n">getfilename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">localfname</span><span class="p">:</span>
            <span class="n">dr</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">localfname</span><span class="p">)</span>
            <span class="n">fbase</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">sfbase</span> <span class="o">=</span> <span class="n">fbase</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="n">entryname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sfbase</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">scinfo</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">fbase</span><span class="p">,</span>
            <span class="s2">&quot;scan_nb&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
            <span class="s2">&quot;session_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session</span><span class="p">,</span>
            <span class="s2">&quot;data_policy&quot;</span><span class="p">:</span> <span class="s1">&#39;no_policy&#39;</span><span class="p">,</span>
            <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">(),</span>
            <span class="s2">&quot;start_time&quot;</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">fbase</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;npoints&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;count_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="c1">##################################</span>
            <span class="s2">&quot;acquisition_chain&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="c1">##################################</span>
            <span class="s2">&quot;display_extra&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;plotselect&quot;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="s2">&quot;plots&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;curve-plot&quot;</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[]}],</span>
            <span class="c1">##################################</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">localfname</span><span class="p">,</span>
            <span class="s2">&quot;images_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">localfname</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;publisher_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;datadesc&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;snapshot&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;measurement_group_channels&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;beamtime_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scan_meta_categories&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;snapshot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datadesc&quot;</span><span class="p">,</span>
                <span class="c1">#     &quot;positioners&quot;,</span>
                <span class="c1">#     &quot;nexuswriter&quot;,</span>
                <span class="c1">#     &quot;instrument&quot;,</span>
                <span class="c1">#     &quot;technique&quot;,</span>
            <span class="p">],</span>
            <span class="c1"># &quot;save&quot;: self.nexus_save,</span>
            <span class="c1"># &quot;data_writer&quot;: &quot;nexus&quot;,</span>
            <span class="c1"># &quot;writer_options&quot;: {</span>
            <span class="c1">#      &quot;chunk_options&quot;: {},</span>
            <span class="c1">#      &quot;separate_scan_files&quot;: False},</span>
            <span class="c1"># &quot;nexuswriter&quot;: {</span>
            <span class="c1">#     &quot;devices&quot;: {},</span>
            <span class="c1">#     &quot;instrument_info&quot;: {</span>
            <span class="c1">#         &quot;name&quot;: &quot;desy-&quot;+self.scan.beamline,</span>
            <span class="c1">#         &quot;name@short_name&quot;: self.scan.beamline},</span>
            <span class="c1">#     &quot;masterfiles&quot;: masterfiles,</span>
            <span class="c1">#     &quot;technique&quot;: {},</span>
            <span class="c1"># },</span>
            <span class="c1"># &quot;positioners&quot;: {},</span>
            <span class="c1"># &quot;instrument&quot;: {},</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">scinfo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_devices</span><span class="p">({})</span>
        <span class="c1"># self.set_devices(</span>
        <span class="c1">#     DeviceDict(name=&quot;counters&quot;, channels=[],</span>
        <span class="c1">#   metadata={}),</span>
        <span class="c1">#     [&quot;counters&quot;])</span>
        <span class="c1"># self.set_devices(</span>
        <span class="c1">#     DeviceDict(name=&quot;axis&quot;, channels=[], metadata={}),</span>
        <span class="c1">#     [&quot;axis&quot;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_devices</span><span class="p">(</span>
            <span class="n">DeviceDict</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mg_channels&quot;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">[],</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{}),</span>
            <span class="p">[</span><span class="s2">&quot;mg_channels&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_devices</span><span class="p">(</span>
            <span class="n">DeviceDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">[],</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{}),</span>
            <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_devices</span><span class="p">(</span>
            <span class="n">DeviceDict</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;observables&quot;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">[],</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{}),</span>
            <span class="p">[</span><span class="s2">&quot;observables&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_channels</span><span class="p">({})</span></div>

<div class="viewcode-block" id="H5RedisFile.set_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.set_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">set_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">direct</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__scaninfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ScanInfoDict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">direct</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaninfo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="o">.</span><span class="n">info</span>

            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sinfo</span> <span class="o">=</span> <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="H5RedisFile.get_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.get_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: scan parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direct</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaninfo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="o">.</span><span class="n">info</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sinfo</span><span class="p">)</span>
            <span class="c1"># print(&quot;KEYS&quot;, keys)</span>
            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">sinfo</span></div>

<div class="viewcode-block" id="H5RedisFile.append_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.append_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">append_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">direct</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaninfo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="o">.</span><span class="n">info</span>
            <span class="n">rkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span> <span class="ow">or</span> <span class="p">[]))</span>
            <span class="k">while</span> <span class="n">rkeys</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="n">rkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ky</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sinfo</span><span class="p">:</span>
                        <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">sinfo</span> <span class="o">=</span> <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ky</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sinfo</span><span class="p">:</span>
                        <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">sinfo</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisFile.scan_command"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.scan_command">[docs]</a>    <span class="k">def</span> <span class="nf">scan_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan attribute</span>

<span class="sd">        :param command: scan command</span>
<span class="sd">        :type command: :obj:`str`</span>
<span class="sd">        :param args: function list arguments</span>
<span class="sd">        :type args: :obj:`list` &lt;`any`&gt;</span>
<span class="sd">        :param kwargs: function dict arguments</span>
<span class="sd">        :type kwargs: :obj:`dict` &lt;:obj:`str` , `any`&gt;</span>
<span class="sd">        :returns: scan command value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vl</span></div>

<div class="viewcode-block" id="H5RedisFile.scan_getattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.scan_getattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :returns: scan attr value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attr</span></div>

<div class="viewcode-block" id="H5RedisFile.scan_setattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.scan_setattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :param value: scan attr value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scan_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scan</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisFile.prepare"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; start scan</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">REDIS</span><span class="p">:</span>
            <span class="n">localfname</span> <span class="o">=</span> <span class="n">H5RedisLink</span><span class="o">.</span><span class="n">getfilename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">())</span>
            <span class="c1"># print(&quot;FILE&quot;, localfname, n, nxclass)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__entryname</span>
            <span class="n">insn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__insname</span>
            <span class="k">if</span> <span class="n">localfname</span><span class="p">:</span>
                <span class="n">dr</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">localfname</span><span class="p">)</span>
                <span class="n">fbase</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="n">sfbase</span> <span class="o">=</span> <span class="n">fbase</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">measurement</span> <span class="o">=</span> <span class="s2">&quot;scan&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sn</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">measurement</span> <span class="o">=</span> <span class="n">sn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sfbase</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">measurement</span> <span class="o">=</span> <span class="n">sfbase</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">measurement</span> <span class="o">=</span> <span class="n">fbase</span>
                <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">()</span>
                <span class="n">scandct</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sinfo</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                           <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">sinfo</span><span class="p">[</span><span class="s2">&quot;scan_nb&quot;</span><span class="p">],</span>
                           <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">fbase</span><span class="p">,</span>
                           <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">dr</span><span class="p">,</span>
                           <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session</span><span class="p">,</span>
                           <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">measurement</span><span class="p">,</span>
                           <span class="s2">&quot;data_policy&quot;</span><span class="p">:</span> <span class="s2">&quot;no_policy&quot;</span><span class="p">}</span>
                <span class="k">if</span> <span class="s2">&quot;beamtime_id&quot;</span> <span class="ow">in</span> <span class="n">sinfo</span><span class="p">:</span>
                    <span class="n">scandct</span><span class="p">[</span><span class="s2">&quot;proposal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinfo</span><span class="p">[</span><span class="s2">&quot;beamtime_id&quot;</span><span class="p">]</span>
                    <span class="n">sinfo</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;beamtime_id&quot;</span><span class="p">)</span>

                <span class="n">beamline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">proposal</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
                    <span class="n">entry</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">insn</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
                        <span class="n">ins</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">insn</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">ins</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
                            <span class="n">insname</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">insname</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;short_name&quot;</span><span class="p">):</span>
                                <span class="n">beamline</span> <span class="o">=</span> <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span>
                                    <span class="n">insname</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;short_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                                <span class="n">scandct</span><span class="p">[</span><span class="s2">&quot;beamline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beamline</span>
                    <span class="k">if</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scandct</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">scandct</span><span class="p">[</span><span class="s2">&quot;proposal&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;experiment_identifier&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
                            <span class="n">proposal</span> <span class="o">=</span> <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span>
                                <span class="n">entry</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;experiment_identifier&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                            <span class="k">if</span> <span class="n">proposal</span><span class="p">:</span>
                                <span class="n">scandct</span><span class="p">[</span><span class="s2">&quot;proposal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposal</span>

                <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datastore</span><span class="o">.</span><span class="n">create_scan</span><span class="p">(</span>
                    <span class="n">scandct</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">fbase</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_scan</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span></div>
                <span class="c1"># scan.prepare()</span>
                <span class="c1"># scan.start()</span>

            <span class="c1"># print(&quot;SCAN&quot;, measurement, number)</span>
            <span class="c1"># print(&quot;NAMES&quot;, self.names())</span>

<div class="viewcode-block" id="H5RedisFile.start"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; start scan</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">REDIS</span><span class="p">:</span>
            <span class="n">acq_chain</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_devices</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">devices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;channels&quot;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
                    <span class="n">dd</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;devices&quot;</span><span class="p">])</span>
            <span class="n">acq_chain</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainDict</span><span class="p">(</span>
                <span class="n">top_master</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="n">devices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">devices</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="n">scalars</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">spectra</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">images</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">master</span><span class="o">=</span><span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">acq_chain</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;acquisition_chain&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_channels</span><span class="p">(),</span> <span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span>

            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_getattr</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
            <span class="n">sinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">()</span>
            <span class="c1"># print(&quot;SCAN INFO&quot;, sinfo)</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sinfo</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="s2">&quot;prepare&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisFile.finish"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisFile.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; start scan</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;FINISH&quot;)</span>
        <span class="c1"># print(&quot;CLOSE GROUP&quot;, self.__nxclass, self.name)</span>
        <span class="k">if</span> <span class="n">REDIS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;seal&quot;</span><span class="p">):</span>
                        <span class="n">stream</span><span class="o">.</span><span class="n">seal</span><span class="p">()</span>
                        <span class="c1"># print(&quot;SEAL&quot;, stream.name)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error sealing stream </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stream</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
            <span class="n">lpars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">([</span><span class="s2">&quot;snapshot&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">{})</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;snapshot&quot;</span><span class="p">],</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lpars</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;snapshot&quot;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">],</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="s1">&#39;SUCCESS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;end_reason&#39;</span><span class="p">],</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># print(&quot;stop SCAN&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span></div></div>
            <span class="c1"># print(&quot;close SCAN&quot;)</span>
            <span class="c1"># self.set_scan(None)</span>
            <span class="c1">#    print(&quot;SCAN None&quot;)</span>


<div class="viewcode-block" id="H5RedisGroup"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup">[docs]</a><span class="k">class</span> <span class="nc">H5RedisGroup</span><span class="p">(</span><span class="n">H5Group</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">nxclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: tree parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        :param h5imp: h5 implementation group</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTGroup`</span>
<span class="sd">        :param redis: redis object</span>
<span class="sd">        :type redis: :obj:`any`</span>
<span class="sd">        :param nxclass: nxclass</span>
<span class="sd">        :type nxclass: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5Group</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5Group</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxclass</span> <span class="o">=</span> <span class="n">nxclass</span>

<div class="viewcode-block" id="H5RedisGroup.open"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; open a file tree element</span>

<span class="sd">        :param name: element name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :returns: file tree object</span>
<span class="sd">        :rtype: :class:`H5RedisLink`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h5obj</span> <span class="o">=</span> <span class="n">H5Group</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5obj</span><span class="p">,</span> <span class="n">H5Group</span><span class="p">):</span>
            <span class="n">nxclass</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">h5obj</span><span class="o">.</span><span class="n">attributes</span><span class="p">]:</span>
                <span class="n">nxclass</span> <span class="o">=</span> <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span>
                    <span class="n">h5obj</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">H5RedisGroup</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5obj</span><span class="p">,</span> <span class="n">nxclass</span><span class="o">=</span><span class="n">nxclass</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5obj</span><span class="p">,</span> <span class="n">H5Field</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">H5RedisField</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5obj</span><span class="p">,</span> <span class="n">H5Attribute</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">H5RedisAttribute</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H5RedisLink</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">h5obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.open_link"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.open_link">[docs]</a>    <span class="k">def</span> <span class="nf">open_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; open a file tree element as link</span>

<span class="sd">        :param name: element name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :returns: file tree object</span>
<span class="sd">        :rtype: :class:`H5RedisLink`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisLink</span><span class="p">(</span><span class="n">h5imp</span><span class="o">=</span><span class="n">H5Group</span><span class="o">.</span><span class="n">open_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_scan"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_scan">[docs]</a>    <span class="k">def</span> <span class="nf">set_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param scan: scan object</span>
<span class="sd">        :param type: :class:`Scan`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_scan&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scan</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.append_stream"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.append_stream">[docs]</a>    <span class="k">def</span> <span class="nf">append_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param name: stream name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param scan: stream object</span>
<span class="sd">        :type scan: :class:`Stream`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_stream&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_stream</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_entryname"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_entryname">[docs]</a>    <span class="k">def</span> <span class="nf">set_entryname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set entry name</span>

<span class="sd">        :param entryname: entry name</span>
<span class="sd">        :type entryname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_entryname&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scan</span><span class="p">(</span><span class="n">entryname</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_insname"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_insname">[docs]</a>    <span class="k">def</span> <span class="nf">set_insname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">insname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set instrument name</span>

<span class="sd">        :param insname: instrument name</span>
<span class="sd">        :type insname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_insname&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scan</span><span class="p">(</span><span class="n">insname</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.append_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.append_devices">[docs]</a>    <span class="k">def</span> <span class="nf">append_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append device parameters</span>

<span class="sd">        :param value: device value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_devices</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_devices">[docs]</a>    <span class="k">def</span> <span class="nf">set_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set device parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_devices</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.get_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.get_devices">[docs]</a>    <span class="k">def</span> <span class="nf">get_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: device parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_devices</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_channels">[docs]</a>    <span class="k">def</span> <span class="nf">set_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set device parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_channels&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_channels</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.get_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.get_channels">[docs]</a>    <span class="k">def</span> <span class="nf">get_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: device parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_channels&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_channels</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.reset_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.reset_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">reset_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; reset scan info</span>

<span class="sd">        :param entryname: NXentry group name</span>
<span class="sd">        :type entryname: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;reset_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">reset_scaninfo</span><span class="p">(</span><span class="n">entryname</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.set_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.set_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">set_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.get_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.get_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: scan parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: scan parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.append_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.append_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">append_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :param direct: scan info direct flag</span>
<span class="sd">        :type direct: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_scaninfo</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.scan_command"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.scan_command">[docs]</a>    <span class="k">def</span> <span class="nf">scan_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan attribute</span>

<span class="sd">        :param command: scan command</span>
<span class="sd">        :type command: :obj:`str`</span>
<span class="sd">        :param args: function list arguments</span>
<span class="sd">        :type args: :obj:`list` &lt;`any`&gt;</span>
<span class="sd">        :param kwargs: function dict arguments</span>
<span class="sd">        :type kwargs: :obj:`dict` &lt;:obj:`str` , `any`&gt;</span>
<span class="sd">        :returns: scan command value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_command&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.scan_getattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.scan_getattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :returns: scan attr value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_getattr&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_getattr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.scan_setattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.scan_setattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :param value: scan attr value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_setattr&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_getattr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.create_group"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.create_group">[docs]</a>    <span class="k">def</span> <span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nxclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; open a file tree element</span>

<span class="sd">        :param n: group name</span>
<span class="sd">        :type n: :obj:`str`</span>
<span class="sd">        :param nxclass: group type</span>
<span class="sd">        :type nxclass: :obj:`str`</span>
<span class="sd">        :returns: file tree group</span>
<span class="sd">        :rtype: :class:`H5RedisGroup`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">REDIS</span> <span class="ow">and</span> <span class="n">nxclass</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NXinstrument&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;NXinstrument&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_insname</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">REDIS</span> <span class="ow">and</span> <span class="n">nxclass</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NXentry&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;NXentry&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_scaninfo</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H5RedisGroup</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="n">H5Group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nxclass</span><span class="p">),</span>
            <span class="n">nxclass</span><span class="o">=</span><span class="n">nxclass</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisGroup.create_virtual_field"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.create_virtual_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_virtual_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; creates a virtual filed tres element</span>

<span class="sd">        :param name: field name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param layout: virual field layout</span>
<span class="sd">        :type layout: :class:`H5CppFieldLayout`</span>
<span class="sd">        :param fillvalue:  fill value</span>
<span class="sd">        :type fillvalue: :obj:`int` or :class:`np.ndarray`</span>
<span class="sd">        :returns: file tree field</span>
<span class="sd">        :rtype: :class:`H5RedisField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisField</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="n">H5Group</span><span class="o">.</span><span class="n">create_virtual_field</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">fillvalue</span><span class="p">))</span></div>

<div class="viewcode-block" id="H5RedisGroup.create_field"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.create_field">[docs]</a>    <span class="k">def</span> <span class="nf">create_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">type_code</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dfilter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; open a file tree element</span>

<span class="sd">        :param n: group name</span>
<span class="sd">        :type n: :obj:`str`</span>
<span class="sd">        :param type_code: nexus field type</span>
<span class="sd">        :type type_code: :obj:`str`</span>
<span class="sd">        :param shape: shape</span>
<span class="sd">        :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param chunk: chunk</span>
<span class="sd">        :type chunk: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param dfilter: filter deflater</span>
<span class="sd">        :type dfilter: :class:`H5CppDataFilter`</span>
<span class="sd">        :returns: file tree field</span>
<span class="sd">        :rtype: :class:`H5RedisField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisField</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="n">H5Group</span><span class="o">.</span><span class="n">create_field</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">type_code</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span>
                <span class="p">(</span><span class="n">dfilter</span> <span class="k">if</span> <span class="n">dfilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dfilter</span><span class="p">)))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; return the attribute manager</span>

<span class="sd">        :returns: attribute manager</span>
<span class="sd">        :rtype: :class:`H5CppAttributeManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisAttributeManager</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="nb">super</span><span class="p">(</span><span class="n">H5RedisGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

<div class="viewcode-block" id="H5RedisGroup.H5RedisGroupIter"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisGroup.H5RedisGroupIter">[docs]</a>    <span class="k">class</span> <span class="nc">H5RedisGroupIter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">            :param group: group object</span>
<span class="sd">            :type group: :obj:`H5RedisGroup`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__group</span> <span class="o">=</span> <span class="n">group</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__names</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">names</span><span class="p">()</span>

        <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; the next attribute</span>

<span class="sd">            :returns: attribute object</span>
<span class="sd">            :rtype: :class:`FTAtribute`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__group</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>

        <span class="nb">next</span> <span class="o">=</span> <span class="fm">__next__</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; attribute iterator</span>

<span class="sd">            :returns: attribute iterator</span>
<span class="sd">            :rtype: :class:`H5RedisAttrIter`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; attribute iterator</span>

<span class="sd">        :returns: attribute iterator</span>
<span class="sd">        :rtype: :class:`H5RedisAttrIter`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H5RedisGroupIter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisField"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField">[docs]</a><span class="k">class</span> <span class="nc">H5RedisField</span><span class="p">(</span><span class="n">H5Field</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: treee parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        :param h5imp: h5 implementation field</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5Field</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5Field</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dsname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__jstream</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="H5RedisField.append_stream"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.append_stream">[docs]</a>    <span class="k">def</span> <span class="nf">append_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param name: stream name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param scan: stream object</span>
<span class="sd">        :type scan: :class:`Stream`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_stream&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_stream</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.set_scan"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.set_scan">[docs]</a>    <span class="k">def</span> <span class="nf">set_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; scan object</span>

<span class="sd">        :param scan: scan object</span>
<span class="sd">        :param type: :class:`Scan`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_scan&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scan</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.append_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.append_devices">[docs]</a>    <span class="k">def</span> <span class="nf">append_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append device parameters</span>

<span class="sd">        :param value: device value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_devices</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.set_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.set_devices">[docs]</a>    <span class="k">def</span> <span class="nf">set_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set device parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_devices</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.get_devices"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.get_devices">[docs]</a>    <span class="k">def</span> <span class="nf">get_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: device parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_devices&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_devices</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.set_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.set_channels">[docs]</a>    <span class="k">def</span> <span class="nf">set_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set device parameters</span>

<span class="sd">        :param value: device parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_channels&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_channels</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.get_channels"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.get_channels">[docs]</a>    <span class="k">def</span> <span class="nf">get_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: device parameter keys</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: device parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_channels&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_channels</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.append_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.append_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">append_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; append scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;append_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">append_scaninfo</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.get_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.get_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan info parameters</span>

<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :returns value: scan parameter value</span>
<span class="sd">        :rtype value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;get_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.set_scaninfo"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.set_scaninfo">[docs]</a>    <span class="k">def</span> <span class="nf">set_scaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan info parameters</span>

<span class="sd">        :param value: scan parameter value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        :param keys: scan parameter value</span>
<span class="sd">        :type key: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;set_scaninfo&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">direct</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.scan_command"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.scan_command">[docs]</a>    <span class="k">def</span> <span class="nf">scan_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set scan attribute</span>

<span class="sd">        :param command: scan command</span>
<span class="sd">        :type command: :obj:`str`</span>
<span class="sd">        :param args: function list arguments</span>
<span class="sd">        :type args: :obj:`list` &lt;`any`&gt;</span>
<span class="sd">        :param kwargs: function dict arguments</span>
<span class="sd">        :type kwargs: :obj:`dict` &lt;:obj:`str` , `any`&gt;</span>
<span class="sd">        :returns: scan command value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_command&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.scan_getattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.scan_getattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get scan attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :returns: scan attr value</span>
<span class="sd">        :rtype:  :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_getattr&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_getattr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span></div>

<div class="viewcode-block" id="H5RedisField.scan_setattr"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisField.scan_setattr">[docs]</a>    <span class="k">def</span> <span class="nf">scan_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set attribute</span>

<span class="sd">        :param attr: scan attr</span>
<span class="sd">        :type attr: :obj:`str`</span>
<span class="sd">        :param value: scan attr value</span>
<span class="sd">        :type value: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="p">,</span> <span class="s2">&quot;scan_setattr&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">scan_getattr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; return the attribute manager</span>

<span class="sd">        :returns: attribute manager</span>
<span class="sd">        :rtype: :class:`H5CppAttributeManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisAttributeManager</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="nb">super</span><span class="p">(</span><span class="n">H5RedisField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_step_channel_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsname</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;STEP&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set step channel info</span>

<span class="sd">        :param dsname: datasource name</span>
<span class="sd">        :type dsname: :obj:`str`</span>
<span class="sd">        :param units: datasource units</span>
<span class="sd">        :type units: :obj:`str`</span>
<span class="sd">        :param shape: datasource shape</span>
<span class="sd">        :type shape: :obj:`list` &lt;:obj:`int`&gt;</span>
<span class="sd">        :param strategy: datasource strategy</span>
<span class="sd">        :type strategy: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">dsname</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">dsname</span><span class="p">,</span>
            <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="n">strategy</span><span class="p">,</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
        <span class="p">}</span>
        <span class="n">anames</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">attrdesc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">anames</span><span class="p">:</span>
                <span class="n">sds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span>
                    <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_scaninfo</span><span class="p">(</span><span class="n">sds</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;datadesc&quot;</span><span class="p">,</span> <span class="n">dsname</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;string&#39;</span><span class="p">]:</span>
            <span class="n">mgchannels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;measurement_group_channels&quot;</span><span class="p">])</span>
            <span class="n">device_type</span> <span class="o">=</span> <span class="s2">&quot;observables&quot;</span>
            <span class="c1"># if &quot;timestamp&quot; in dsname or \</span>
            <span class="c1">#    dsname.endswith(&quot;_time&quot;):</span>
            <span class="k">if</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">dsname</span><span class="p">:</span>
                <span class="n">device_type</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
            <span class="k">elif</span> <span class="n">dsname</span> <span class="ow">in</span> <span class="n">mgchannels</span><span class="p">:</span>
                <span class="n">device_type</span> <span class="o">=</span> <span class="s2">&quot;mg_channels&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">append_devices</span><span class="p">(</span>
                <span class="n">dsname</span><span class="p">,</span> <span class="p">[</span><span class="n">device_type</span><span class="p">,</span> <span class="s1">&#39;channels&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">units</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">ChannelDict</span><span class="p">(</span>
                    <span class="n">device</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                    <span class="n">display_name</span><span class="o">=</span><span class="n">dsname</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">ChannelDict</span><span class="p">(</span>
                    <span class="n">device</span><span class="o">=</span><span class="n">device_type</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
                    <span class="n">display_name</span><span class="o">=</span><span class="n">dsname</span><span class="p">)</span>
            <span class="c1"># print(&quot;CHANNEL&quot;, dsname)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_channels</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="p">[</span><span class="n">dsname</span><span class="p">])</span>

            <span class="n">encoder</span> <span class="o">=</span> <span class="n">NumericStreamEncoder</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span>
                <span class="s2">&quot;create_stream&quot;</span><span class="p">,</span>
                <span class="n">dsname</span><span class="p">,</span>
                <span class="n">encoder</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">units</span><span class="p">})</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shape</span><span class="p">:</span>
                <span class="c1"># plot_type = 1</span>
                <span class="c1"># plot_axes = []</span>
                <span class="c1"># axes = []</span>
                <span class="c1"># self.append_scaninfo(</span>
                <span class="c1">#     {&quot;kind&quot;: &quot;curve-plot&quot;,</span>
                <span class="c1">#      &quot;name&quot;: dsname,</span>
                <span class="c1">#      &quot;items&quot;: axes}, [&quot;plots&quot;])</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append_scaninfo</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;1d-plot&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">dsname</span><span class="p">,</span>
                     <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
                         <span class="c1"># {</span>
                         <span class="c1">#     &quot;kind&quot;: &quot;curve&quot;,</span>
                         <span class="c1">#     &quot;y&quot;: dsname</span>
                         <span class="c1"># }</span>
                     <span class="p">]},</span>
                    <span class="p">[</span><span class="s2">&quot;plots&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_stream</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__jstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span><span class="p">(</span>
                <span class="s2">&quot;create_stream&quot;</span><span class="p">,</span>
                <span class="n">dsname</span><span class="p">,</span> <span class="n">JsonStreamEncoder</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_stream</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jstream</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_init_channel_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsname</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set init channel info</span>

<span class="sd">        :param dsname: datasource name</span>
<span class="sd">        :type dsname: :obj:`str`</span>
<span class="sd">        :param units: datasource units</span>
<span class="sd">        :type units: :obj:`str`</span>
<span class="sd">        :param shape: datasource shape</span>
<span class="sd">        :type shape: :obj:`list` &lt;:obj:`int`&gt;</span>
<span class="sd">        :param strategy: datasource strategy i.e. INIT or FINAL</span>
<span class="sd">        :type strategy: :obj:`str`</span>
<span class="sd">        :param o: object value to write</span>
<span class="sd">        :type o: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">dsname</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">dsname</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">o</span><span class="p">,</span>
            <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="n">strategy</span><span class="p">,</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
        <span class="p">}</span>

        <span class="n">anames</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">attrdesc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">anames</span><span class="p">:</span>
                <span class="n">ids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span>
                    <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
        <span class="n">ids</span><span class="p">[</span><span class="s2">&quot;nexus_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_scaninfo</span><span class="p">([</span><span class="s2">&quot;snapshot&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">dsn</span> <span class="o">=</span> <span class="n">dsname</span>
        <span class="k">while</span> <span class="n">dsn</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="n">dsn</span> <span class="o">=</span> <span class="n">dsn</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_scaninfo</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;snapshot&quot;</span><span class="p">,</span> <span class="n">dsn</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;program_name&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">progattrdesc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">anames</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">np</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span>
                            <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
                        <span class="k">if</span> <span class="n">vl</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">np</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">set_scaninfo</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__set_channel_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set channel value</span>

<span class="sd">        :param o: object value to write</span>
<span class="sd">        :type o: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
        <span class="n">strategy</span> <span class="o">=</span> <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;nexdatas_strategy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">dsname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tparent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dsnm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nexdatas_source&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
            <span class="n">dsnm</span> <span class="o">=</span> <span class="n">getdsname</span><span class="p">(</span>
                <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;nexdatas_source&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
            <span class="n">dsname</span> <span class="o">=</span> <span class="n">dsnm</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">filewriter</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dsname</span> <span class="o">=</span> <span class="n">dsname</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span>
        <span class="c1"># print(&quot;SETITEM&quot;, self, self.name, self.shape,</span>
        <span class="c1">#       self.attributes.names(),</span>
        <span class="c1">#        self.__dsname, strategy, self.dtype,</span>
        <span class="c1">#       type(o), str(t), units)</span>
        <span class="k">if</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;STEP&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">dsnm</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__set_step_channel_info</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">strategy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_init_channel_info</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; set value</span>

<span class="sd">        :param t: slice tuple</span>
<span class="sd">        :type t: :obj:`tuple`</span>
<span class="sd">        :param o: h5 object</span>
<span class="sd">        :type o: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">REDIS</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="s2">&quot;nexdatas_strategy&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__set_channel_info</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">REDIS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__stream</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="n">jo</span> <span class="o">=</span> <span class="n">o</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__jstream</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">jo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">o</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__jstream</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">jo</span><span class="p">)</span>
        <span class="n">H5Field</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisLink"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisLink">[docs]</a><span class="k">class</span> <span class="nc">H5RedisLink</span><span class="p">(</span><span class="n">H5Link</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: treee parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5Link</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5Link</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisDataFilter"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisDataFilter">[docs]</a><span class="k">class</span> <span class="nc">H5RedisDataFilter</span><span class="p">(</span><span class="n">H5DataFilter</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree deflate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: treee parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        :param h5imp: h5 implementation data filter</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTDataFilter`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5DataFilter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">shuffle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">rate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterid</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">filterid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">options</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">availability</span> <span class="o">=</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">availability</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5DataFilter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisVirtualFieldLayout"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisVirtualFieldLayout">[docs]</a><span class="k">class</span> <span class="nc">H5RedisVirtualFieldLayout</span><span class="p">(</span><span class="n">H5VirtualFieldLayout</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; virtual field layout &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param shape: shape</span>
<span class="sd">        :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param dtype: attribute type</span>
<span class="sd">        :type dtype: :obj:`str`</span>
<span class="sd">        :param maxshape: shape</span>
<span class="sd">        :type maxshape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param h5imp: h5 implementation  virtual field layout</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTVirtualFieldLayout`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5VirtualFieldLayout</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                <span class="n">h5imp</span><span class="o">.</span><span class="n">maxshape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5VirtualFieldLayout</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">maxshape</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisTargetFieldView"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisTargetFieldView">[docs]</a><span class="k">class</span> <span class="nc">H5RedisTargetFieldView</span><span class="p">(</span><span class="n">H5TargetFieldView</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; target field for VDS &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fieldpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param filename: file name</span>
<span class="sd">        :type filename: :obj:`str`</span>
<span class="sd">        :param fieldpath: nexus field path</span>
<span class="sd">        :type fieldpath: :obj:`str`</span>
<span class="sd">        :param shape: shape</span>
<span class="sd">        :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param dtype: attribute type</span>
<span class="sd">        :type dtype: :obj:`str`</span>
<span class="sd">        :param maxshape: shape</span>
<span class="sd">        :type maxshape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param h5imp: h5 implementation targetfieldview</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTTargetFieldView`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">H5CPP</span><span class="p">:</span>
                <span class="n">H5TargetFieldView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">fieldpath</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">h5imp</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">maxshape</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H5TargetFieldView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">fieldpath</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">h5imp</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">maxshape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fieldpath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">H5CPP</span><span class="p">:</span>
                <span class="n">H5TargetFieldView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fieldpath</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">maxshape</span><span class="p">)</span></div>


<div class="viewcode-block" id="H5RedisDeflate"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisDeflate">[docs]</a><span class="k">class</span> <span class="nc">H5RedisDeflate</span><span class="p">(</span><span class="n">H5RedisDataFilter</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; deflate filter &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="H5RedisAttributeManager"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisAttributeManager">[docs]</a><span class="k">class</span> <span class="nc">H5RedisAttributeManager</span><span class="p">(</span><span class="n">H5AttributeManager</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: treee parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        :param h5imp: h5 implementation attributemanager</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTAttributeManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5AttributeManager</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5AttributeManager</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span>

<div class="viewcode-block" id="H5RedisAttributeManager.create"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisAttributeManager.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; create a new attribute</span>

<span class="sd">        :param name: attribute name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param dtype: attribute type</span>
<span class="sd">        :type dtype: :obj:`str`</span>
<span class="sd">        :param shape: attribute shape</span>
<span class="sd">        :type shape: :obj:`list` &lt; :obj:`int` &gt;</span>
<span class="sd">        :param overwrite: overwrite flag</span>
<span class="sd">        :type overwrite: :obj:`bool`</span>
<span class="sd">        :returns: attribute object</span>
<span class="sd">        :rtype: :class:`H5RedisAttribute`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisAttribute</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="n">H5AttributeManager</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; get value</span>

<span class="sd">        :param name: attribute name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :returns: attribute object</span>
<span class="sd">        :rtype: :class:`FTAtribute`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">H5RedisAttribute</span><span class="p">(</span>
            <span class="n">h5imp</span><span class="o">=</span><span class="n">H5AttributeManager</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="H5RedisAttribute"><a class="viewcode-back" href="../../nxstools.html#nxstools.h5rediswriter.H5RedisAttribute">[docs]</a><span class="k">class</span> <span class="nc">H5RedisAttribute</span><span class="p">(</span><span class="n">H5Attribute</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; file tree attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param h5object: h5 object</span>
<span class="sd">        :type h5object: :obj:`any`</span>
<span class="sd">        :param tparent: treee parent</span>
<span class="sd">        :type tparent: :obj:`FTObject`</span>
<span class="sd">        :param h5imp: h5 implementation attribute</span>
<span class="sd">        :type h5imp: :class:`filewriter.FTAttribute`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">h5imp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">H5Attribute</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">h5object</span><span class="p">,</span> <span class="n">h5imp</span><span class="o">.</span><span class="n">_tparent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h5object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Undefined constructor parameters&quot;</span><span class="p">)</span>
            <span class="n">H5Attribute</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5object</span><span class="p">,</span> <span class="n">tparent</span><span class="p">)</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2018 DESY, Jan Kotanski &lt;jkotan@mail.desy.de&gt;

GNU GENERAL PUBLIC LICENSE, version 3.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>